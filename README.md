# Облачное хранилище

## Обзор

REST API сервис облачного хранения файлов предоставляет возможность пользователям регистрироваться и управлять своим хранилищем.

> Примечание: объекты деляться на файлы и папки

## Содержание
- [Архитектура проекта](#архитектура-проекта)
   - [Используемые технологии](#используемые-технологии)
   - [Модель данных](#модель-данных)
   - [Отношения](#отношения)
   - [Архитектурный стиль](#архитектурный-стиль)
- [Возможности API (Endpoints)](#возможности-api-endpoints)
  - [Зарегистрироваться](#зарегистрироваться)
  - [Войти](#войти)
  - [Получить данные аккаунта](#получить-данные-аккаунта)
  - [Загрузить файл на сервер](#загрузить-файл-на-сервер)
  - [Выгрузить файл с сервера](#выгрузить-файл-с-сервера)
  - [Удалить файл с сервера](#удалить-файл-с-сервера)
  - [Создать папку](#создать-папку)
  - [Удалить папку](#удалить-папку)
  - [Получить свойства объекта](#получить-свойства-объекта)
  - [Получить все объекты в директории](#получить-все-объекты-в-директории)
  - [Поиск объекта по имени](#поиск-объекта-по-имени)
- [Детали реализации](#детали-реализации)
   - [Войти](#войти-1)
   - [Зарегистрироваться](#зарегистрироваться-1)
   - [Добавить](#добавить)
   - [Получить](#получить)
   - [Удалить](#удалить)
   - [Найти](#найти)
- [Ограничения](#ограничения)

## Архитектура проекта
В этом разделе показана общая структура API.

---

### Используемые технологии

![Architecture api](img/architecture.png)

- **Maven** для управления проектами на Java, который позволяет легко управлять зависимостями, компилировать и собирать проекты
- **Docker** для разработки, доставки и запуска приложений в контейнерах. 
- **Spring**
  - Spring Boot для разработки приложений на Java, который упрощает процесс создания самостоятельных, продуктивных и гибких приложений.
  - Spring Data (JPA) для взаимодействия c базой данных.
  - Spring Security для аунтентификации и авторизации пользователей через JWT-токен.
- **JUnit** - для написания и запуска автоматических тестов.
- **Mockito** - для создания мок-объектов в юнит-тестах, что позволяет изолировать тестируемый код от внешних зависимостей.
- **Postgresql** - для хранения пользовательских данных и информации о файлах.
- **Minio** - S3 хранилище для файлов (В Minio нет папок. Все в minio является «объектом». Папки создаются на основе /косой черты - в имени файла)

### Модель данных

![Model data](img/data-model.jpg)

API имеет два основных объекта модели: Пользователь, Детали объекта

### Отношения
Один пользователь может иметь 0 или более разных файлов, поэтому связь между account является «один ко многим».

### Архитектурный стиль

В данном проекте используется архитектурный стиль **REST API**, основанный на принципах REST.

Это означает, что взаимодействие между клиентом и сервером осуществляется через HTTP протокол с использованием стандартных методов запросов (GET, POST, PUT, DELETE) к определенным ресурсам (URL). 

Клиенты могут отправлять запросы на сервер для выполнения операций над ресурсами, а сервер отвечает на эти запросы соответствующими HTTP статусами и данными в формате JSON.

---

## Возможности API (Endpoints)
В этом разделе показаны функции API.
Подробнее см. - [детали реализации](#детали-реализации).

---

### Зарегистрироваться
- Метод: POST
- URL: `/authAccount/signUp`
- Описание: Регистрирует нового пользователя в системе
- Параметры запроса:
```json
{
    "login": "vianny",
    "password": "qwerty12345"
}
```
- Ответ:
```json
{
    "httpStatus": "CREATED",
    "message": "Successfully",
    "dateTime": "2024.03.30 20:56:24"
}
```

### Войти

- Метод: POST
- URL: `/authAccount/signIn`
- Описание: Аутентифицирует пользователя и возвращает токен доступа
- Параметры запроса:
```json
{
    "login": "vianny",
    "password": "qwerty12345"
}
```
- Ответ:
```json
{
    "httpStatus": "OK",
    "jwtToken": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ2aWFubnkiLCJpYXQiOjE3MTE4MjI2NTQsImV4cCI6MTcxMTg0MjY1NH0.vup6-lpps3yE-Hm9k_i0IpILfOLSy1fnBQlxap4yUU8",
    "dateTime": "2024-03-30T21:17:34.640429459"
}
```

### Получить данные аккаунта

- Метод: GET
- URL: `/myCloud/account/details`
- Описание: Получает данные аккаунта текущего пользователя
- Параметры запроса:
  - Authorization: `Bearer eyJhbGciOiJIUzI1NiJ9...`
- Ответ:
```json
{
    "httpStatus": "FOUND",
    "details": [
        {
            "login": "vianny",
            "sizeStorage": 1073741824
        }
    ],
    "dateTime": "2024-03-30T21:20:33.998093954"
}
```

### Загрузить файл на сервер

- Метод: POST
- URL: `/myCloud/upload`
- Описание: Загружает файл на сервер.
- Параметры запроса:
  - Authorization: `Bearer eyJhbGciOiJIUzI1NiJ9...`
  - file:file
  - path:папка/../ (указывается директория как в любой ОС)
- Ответ:
```json
{
    "httpStatus": "CREATED",
    "message": "File successfully uploaded",
    "dateTime": "2024.03.30 21:37:39"
}
```

### Выгрузить файл с сервера

- Метод: GET
- URL: `/myCloud/download/?path={path}`
- Описание: Выгружает файл с сервера
- Параметры запроса:
  - Authorization: `Bearer eyJhbGciOiJIUzI1NiJ9...`
  - path: Путь к файлу (files/)
- Ответ: Файл для скачивания

### Удалить файл с сервера

- Метод: DELETE
- URL: `/myCloud/?path={path}/&filename={filename}`
- Описание: Удаляет файл с сервера
- Параметры запроса:
  - Authorization: `Bearer eyJhbGciOiJIUzI1NiJ9...`
  - path: Путь к файлу (files/)
  - filename: Имя файла (file1)
- Ответ:
```json
{
    "httpStatus": "OK",
    "message": "File successfully deleted",
    "dateTime": "2024.03.30 22:31:27"
}
```

### Создать папку

- Метод: POST
- URL: `/myCloud/createFolder`
- Описание: Создает новую папку на сервере
- Параметры запроса:
```json
{
    "folderName": "photos",
    "path": "files/"
}
```
- Ответ:
```json
{
    "httpStatus": "CREATED",
    "message": "Folder successfully created",
    "dateTime": "2024.03.30 23:00:36"
}
```

### Удалить папку

- Метод: DELETE
- URL: `/deleteFolder/?path={path}&folderName={foldername}`
- Описание: Удаляет папку
- Параметры запроса:
  - Authorization: `Bearer eyJhbGciOiJIUzI1NiJ9...`
  - path: Путь к папке (files/)
  - folderName: Имя файла (photos)
- Ответ:
```json
{
    "httpStatus": "OK",
    "message": "Folder successfully delete",
    "dateTime": "2024.03.30 23:06:49"
}
```

### Получить свойства объекта

- Метод: GET
- URL: `/myCloud/?path={path}/&filename={filename}`
- Описание: Получает свойства (метаданные) объекта
- Параметры запроса:
  - Authorization: `Bearer eyJhbGciOiJIUzI1NiJ9...`
  - path: Путь к объекту (objects/)
  - objectName: Имя объекта (object1)
  - type: Тип объекта (File)
- Ответ:
```json
{
    "httpStatus": "FOUND",
    "properties": [
        {
            "objectName": "object1",
            "objectType": "File",
            "objectLocation": "vianny/objects/",
            "objectSize": 31,
            "uploadDate": "2024-03-30T22:38:39.808083"
        }
    ],
    "dateTime": "2024.03.30 22:38:49"
}
```

### Получить все объекты в директории

- Метод: GET
- URL: `/myCloud/?path={path}`
- Описание: Получает список всех объектов в указанной директории
- Параметры запроса:
  - Authorization: `Bearer eyJhbGciOiJIUzI1NiJ9...`
  - path: Путь к объекту (files/)
- Ответ:
```json
{
    "httpStatus": "FOUND",
    "objects": [
        {
            "objectName": "file1",
            "objectType": "File"
        },
        {
            "objectName": "photo1.jpg",
            "objectType": "File"
        }
        {
            "objectName": "folder1",
            "objectType": "Folder"
        }
    ],
    "dateTime": "2024.03.30 22:57:48"
}
```

### Поиск объекта по имени

- Метод: GET
- URL: `/myCloud/search?objectName={objectnNme}`
- Описание: Выполняет поиск объекта (файла или папки) по имени
- Параметры запроса:
  - Authorization: `Bearer eyJhbGciOiJIUzI1NiJ9...`
  - objectName: Имя объекта (photos)
- Ответ:
```json
{
    "httpStatus": "FOUND",
    "objects": [
        {
            "objectName": "photos",
            "objectType": "Folder",
            "objectLocation": "vianny/files/",
            "objectSize": 0,
            "uploadDate": "2024-03-30T23:10:01.023725"
        }
    ],
    "dateTime": "2024.03.30 23:10:10"
}
```

---

## Детали реализации

В этом разделе представлены диаграммы и описания каждой функции приложения.

Диаграммы должны быть краткими и легкими для понимания. В результате некоторые детали для краткости опущены, но их можно найти в описании каждой функции.

> **Примечание:**
> 
> Клиент — фактический пользователь приложения.
> Аккаунт — объект в базе данных.

---

### Войти

![Sign in](img/sign-in.jpg)

1. Клиент указывает данные такие как `login` и `password` и отправляет POST запрос на сервер.
2. Контроллер принимает этот запрос, получает из него параметры и пытается найти аккаунт в базе данных по логину.
3. Если пользователь не найден в базе данных, то это значит, что клиент предоставил неверные учетные данные. Контроллер отправляет ответ об ошибке.
4. Если логин и пароль, предоставленный клиентом, не совпадают, это снова означает, что клиент предоставил неверные учетные данные. Контроллер отправляет ответ об ошибке.
5. Контроллер генерирует JWT-токен (с определенным временем) и отправляет его вместе с ответом.

---

### Зарегистрироваться

![Sign up](img/sign-up.jpg)

1. Клиент указывает данные для регистраци в виде `login` и `password` и отправляет POST запрос на сервер.
2. Контроллер принимает этот запрос, получает из него параметры и пытается найти аккаунт в базе данных по имени пользователя.
3. Если аккаунт найден в базе данных, это означает, что клиент предоставил логин, которое уже занято.
4. Контроллер показывает ответ об ошибке.
5. Контроллер создает объект аккаунта на основе предоставленных учетных данных и сохраняет его в базе данных.

---

### Добавить

![Add file](img/add-file.jpg)

**Добавление файла на сервер (загрузка):**

1. Клиент отправляет данные, такие как `JWT-токен` в параметрах запроса, а также `file`(полноценный файл) и `path`, в POST-запросе на сервер.
2. Если токен не совпадает, то это означает, что аутентификация не удалась или токен был изменен или истек.
3. Контроллер принимает запрос, извлекает из него параметры и осуществляет поиск файла в базе данных, находящихся в указанной директории.
4. Если файл найден, это означает, что файл с таким именем уже существует на сервере. Контроллер отправляет ответ об ошибке.
5. Если файл не был найден, контроллер сохраняет метаданные файла в базу данных и сам файл в S3 хранилище, после чего отправляет сообщение об успешном добавлении.

---

![Add folder](img/add-folder.jpg)

**Добавление папки на сервер (создание):**

1. Клиент отправляет данные, такие как `JWT-токен` в параметрах запроса, а также `folderName` и `path`, в POST-запросе на сервер.
2. Если токен не совпадает, то это означает, что аутентификация не удалась или токен был изменен или истек.
3. Контроллер принимает запрос, извлекает из него параметры и осуществляет поиск папки в базе данных, находящихся в указанной директории.
4. Если папка найдена, это означает, что папка с таким именем уже существует на сервере. Контроллер отправляет ответ об ошибке.
5. Если папка не была найдена, контроллер сохраняет метаданные папки в базу данных, после чего отправляет сообщение об успешном добавлении.

---

### Получить

![Get file](img/get-file.jpg)

**Получить файл с сервера (выгрузка):**

1. Клиент передает данные, такие как `path` и `JWT-токен`, в параметрах запроса и отправляет GET-запрос на сервер.
2. Если токен не совпадает, то это означает, что аутентификация не удалась или токен был изменен или истек.
3. Контроллер принимает запрос, извлекает из него параметры и осуществляет поиск файла в базе данных, находящихся в указанной директории.
4. Если файл не найден, то это означает, что такого файла не существует на сервере. Контроллер отправляет ответ об ошибке.
5. Если файл был найден, контроллер получает файл из S3 хранилища, после чего отправляет его вместе с ответом.

---

![Get properties file](img/get-properties-file.jpg)

**Получить свойства объекта:**

1. Клиент передает данные, такие как `path`, `objectName`, `type` и `JWT-токен`, в параметрах запроса и отправляет GET-запрос на сервер.
2. Если токен не совпадает, то это означает, что аутентификация не удалась или токен был изменен или истек.
3. Контроллер принимает этот запрос, извлекает из него параметры и осуществяет поиск объекта по имени в базе данных, находящийся в указанной директории.
4. Если объект не найден, то это означает, что такого объекта не существует на сервере. Контроллер отправляет ответ об ошибке.
5. Если объект был найден, контроллер получает его метаданные, после чего отправляет их вместе с ответом.

---

![Get all objects](img/get-all-objects.jpg)

**Получить все объекты в директории:**

1. Клиент передает `path` и `JWT-токен` в параметрах запроса и отправляет GET-запрос на сервер.
2. Если токен не совпадает, то это означает, что аутентификация не удалась или токен был изменен или истек.
3. Контроллер принимает этот запрос, извлекает из него параметры и осуществляет поиск всех объектов в базе данных, находящихся в указанной директории.
4. Получив список объектов они отправляются вместе с ответом.

---

![Get data account](img/get-data-account.jpg)

**Получить данные аккаунта:**

1. Клиент передает `JWT-токен` в параметрах запроса и отправляет GET-запрос на сервер.
2. Если токен не совпадает, то это означает, что аутентификация не удалась или токен был изменен или истек.
3. Контроллер принимает этот запрос, извлекает из него параметры и осуществляет поиск аккаунта в бвзе данных.
4. Получив данные аккаунта они отправляются вместе с ответом.

---

### Удалить

![Delete file](img/delete-file.jpg)

**Удалить файл с сервера:**

1. Клиент передает данные, такие как `path`, `filename` и `JWT-токен`, в параметрах запроса и отправляет DELETE-запрос на сервер.
2. Если токен не совпадает, то это означает, что аутентификация не удалась или токен был изменен или истек.
3. Контроллер принимает этот запрос, извлекает из него параметры и осуществляет поиск файла по имени в базе данных, находящийся в указанной директории.
4. Если файл не найден, то это означает, что такого файла не существует на сервере. Контроллер отправляет ответ об ошибке.
5. Если файл был найден, контроллер удаляет метаданные из базы данных и сам файл из хранилища S3, после чего отправляет сообщение об успешном удалении.

---

![Delete folder](img/delete-folder.jpg)

**Удалить папку с сервера:**

1. Клиент передает данные, такие как `path`, `folderName` и `JWT-токен`, в параметрах запроса и отправляет DELETE-запрос на сервер.
2. Если токен не совпадает, то это означает, что аутентификация не удалась или токен был изменен или истек.
3. Контроллер принимает этот запрос, извлекает из него параметры и осуществляет поиск папки по имени в базе данных, находящийся в указанной директории.
4. Если папка не найдена, то это означает, что такой папки не существует на сервере. Контроллер отправляет ответ об ошибке.
5. Если папка была найдена, контроллер удаляет метаданные с базы данных, после чего отправляет сообщение об успешном удалении.

---

### Найти

![Search object](img/search-object.jpg)

**Поиск объекта:**

1. Клиент передает данные, такие как `objectName` и `JWT-токен`, в параметрах запроса и отправляет GET-запрос на сервер.
2. Если токен не совпадает, то это означает, что аутентификация не удалась или токен был изменен или истек.
3. Контроллер принимает этот запрос, извлекает из него параметры и осуществляет поиск объекта по предоставленному имени в базе данных.
4. Если объект не найден, то это означает, что такого объекта не существует на сервере. Контроллер отправляет ответ об ошибке.
5. Если объект был найден, то метаданные отправляются вместе с ответом.

---

# Ограничения
> Пользователь может загружать только по одному файлу за запрос

> Максимальный размер загружаемого файла - 1000MB

> Нет валидации у path (может быть любой - ./, /// и тд)
